<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.6">Jekyll</generator><link href="http://localhost:4000/blog/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/blog/" rel="alternate" type="text/html" /><updated>2020-03-05T21:16:10+05:30</updated><id>http://localhost:4000/blog/</id><title type="html">Sukeesh</title><subtitle>Personal blog</subtitle><author><name>Sukeesh</name><email>vsukeeshbabu@gmail.com</email></author><entry><title type="html">Setting up and Troubleshooting Prometheus in Kubernetes</title><link href="http://localhost:4000/blog/2020-03-05/prometheus" rel="alternate" type="text/html" title="Setting up and Troubleshooting Prometheus in Kubernetes" /><published>2020-03-05T00:00:00+05:30</published><updated>2020-03-05T00:00:00+05:30</updated><id>http://localhost:4000/blog/2020-03-05/prometheus</id><content type="html" xml:base="http://localhost:4000/blog/2020-03-05/prometheus">&lt;hr /&gt;
&lt;h3 id=&quot;prometheus&quot;&gt;Prometheus&lt;/h3&gt;

&lt;p&gt;Prometheus is an open-source systems monitoring and alerting toolkit. It scrapes metrics from instrumented jobs, either directly or via an intermediary push gateway for short-lived jobs. It stores all scraped samples locally and runs rules over this data to either aggregate and record new time series from existing data or generate alerts. &lt;a href=&quot;https://prometheus.io/docs/introduction/overview/&quot;&gt;link&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I tried to make this blog post as simple as possible and it has all the basic components required to setup Prometheus successfully in your microservice.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;architecture&quot;&gt;Architecture&lt;/h3&gt;

&lt;p&gt;Ignore this section if it’s too confusing to understand&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://prometheus.io/assets/architecture.png&quot; alt=&quot;Prom&quot; title=&quot;Architecture&quot; /&gt; &lt;a href=&quot;https://prometheus.io/docs/introduction/overview/&quot;&gt;ref&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;prometheus-client-python&quot;&gt;Prometheus Client (Python)&lt;/h3&gt;

&lt;div class=&quot;language-py highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;prometheus_client&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start_http_server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Counter&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;random&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;time&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'count'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'Description of counter'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;start_http_server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Above is a simple http server which has a Prometheus Counter implemented. Counter is incremented by &lt;code class=&quot;highlighter-rouge&quot;&gt;0.1&lt;/code&gt; everytime &lt;code class=&quot;highlighter-rouge&quot;&gt;c.inc(0.1)&lt;/code&gt; is called. Run the above program and try to curl &lt;code class=&quot;highlighter-rouge&quot;&gt;localhost:8000/metrics&lt;/code&gt; and you should see the following metrics being served.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ curl localhost:8000/metrics

# HELP python_info Python platform information
# TYPE python_info gauge
python_info{implementation=&quot;CPython&quot;,major=&quot;3&quot;,minor=&quot;7&quot;,patchlevel=&quot;6&quot;,version=&quot;3.7.6&quot;} 1.0
# HELP python_gc_collected_objects Objects collected during gc
# TYPE python_gc_collected_objects histogram
# HELP python_gc_uncollectable_objects Uncollectable object found during GC
# TYPE python_gc_uncollectable_objects histogram
# HELP python_gc_duration_seconds Time spent in garbage collection
# TYPE python_gc_duration_seconds histogram
# HELP count_total Some description
# TYPE count_total counter
count_total 0.7
# TYPE count_created gauge
count_created 1583416778.013898
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;tip&quot;&gt;Tip&lt;/h3&gt;

&lt;p&gt;To check if above metrics are in valid format, you can use &lt;code class=&quot;highlighter-rouge&quot;&gt;promtool&lt;/code&gt; to validate&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s&quot;&gt;$ curl localhost:8000/metrics | promtool check metrics&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;storage&quot;&gt;Storage&lt;/h3&gt;

&lt;p&gt;Prometheus includes a local on-disk time series database, but also optionally integrates with remote storage systems.&lt;/p&gt;

&lt;p&gt;Here, let’s focus on local storage and we need to provide some dir path to Prometheus to write metrics to and for that to write, we need to set environment variable &lt;code class=&quot;highlighter-rouge&quot;&gt;prometheus_multiproc_dir&lt;/code&gt; (default) to some temporary dir like &lt;code class=&quot;highlighter-rouge&quot;&gt;/tmp&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Some examples of remote storage include &lt;a href=&quot;https://github.com/prometheus/pushgateway&quot;&gt;Prometheus Pushgateway&lt;/a&gt;. Used to allow ephemeral and batch jobs to expose their metrics to Prometheus. Since these kinds of jobs may not exist long enough to be scraped, they can instead push their metrics to a Pushgateway. The Pushgateway then exposes these metrics to Prometheus.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;prometheus-scrape&quot;&gt;Prometheus scrape&lt;/h3&gt;

&lt;p&gt;Now, that these metrics are being served, we somehow need to tell Prometheus server to scrape these metrics from these pods.&lt;/p&gt;

&lt;p&gt;For the above purpose, we need to have per pod Prometheus annotations which allow a fine control of the scraping process. These annotations need to be part of pod metadata.&lt;/p&gt;

&lt;p&gt;Annotations required:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;prometheus.io/scrape&lt;/code&gt; Default config will scrape all pods (true/false)&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;prometheus.io/path&lt;/code&gt; If the metrics path is not /metrics, define it with this annotation.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;prometheus.io/port&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;
&lt;h3 id=&quot;example&quot;&gt;Example&lt;/h3&gt;

&lt;p&gt;In our case, K8s config will look like below&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;annotations&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;prometheus.io/scrape&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;true'&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;prometheus.io/port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;8000'&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;prometheus_multiproc_dir&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/tmp&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h3&gt;

&lt;p&gt;Above should export all the metrics on pods to prometheus server. You can check on Prometheus targets and verify if these are being exported.&lt;/p&gt;

&lt;p&gt;Now, this data can be consumed to show visualizations like on Grafana. :tada:&lt;/p&gt;

&lt;p&gt;If still stuck while setting up, Hire me on &lt;a href=&quot;http://codementor.io/sukeesh&quot;&gt;Codementor.io&lt;/a&gt; :wink:&lt;/p&gt;</content><author><name>Sukeesh</name></author><summary type="html">Prometheus</summary></entry><entry><title type="html">Started Contributing to Kubernetes</title><link href="http://localhost:4000/blog/2019-08-01/started-kubernetes" rel="alternate" type="text/html" title="Started Contributing to Kubernetes" /><published>2019-08-01T00:00:00+05:30</published><updated>2019-08-01T00:00:00+05:30</updated><id>http://localhost:4000/blog/2019-08-01/started-kubernetes</id><content type="html" xml:base="http://localhost:4000/blog/2019-08-01/started-kubernetes">So, finally started [contributing to the Kubernetes source code on github](https://github.com/kubernetes/kubernetes/pulls/sukeesh). At first, I was really worried after looking at the source code as It was too huge. But finally, I made up my mind to start with [good first issues](https://github.com/kubernetes/kubernetes/issues?q=is%3Aopen+is%3Aissue+label%3A%22good+first+issue%22). 

Most of the good first issues were to cleanup the source code, add docs in the code kind of stuff and seemed really easy to me. So, came up with this PR [#79367](https://github.com/kubernetes/kubernetes/pull/79367) to start off. The code review flow was really good (even though took a bit time) and this PR was finally merged by the bot. :wink:

![Merged](../assets/images/july2019/merge.png &quot;Yaay&quot;)

I was really happy on that day. I was little more encouraged to contribute more. So, now came up with this huge PR[#79566](https://github.com/kubernetes/kubernetes/pull/79566), which does solve the same issue of capitalizing error strings. I changed the code in various places (31 files). So, it involved various packages:cry: and this really took a long time to get the code approved :ballot_box_with_check: as there are different maintainers for each package.

![Labels](../assets/images/july2019/labels_huge.png &quot;Too many&quot;)


So, now that I'm little familiar with this, I was excited to fix some more real bugs/issues. I actually found a small bug wherein Horizontal Pod Autoscaler was showing incorrect status in the events log. 
For example, the case when
```go
desiredReplicas = 1
minimumAllowedReplicas = 2
hpaMinReplicas = 2
```
Event logs said 
```
TooFewReplicas
the desired replica count is more than the maximum replica count
```
which defnitely is wrong and when I read the code realted to autoscaler part, I found the issue:sweat_smile:&lt;br&gt;
I, Immediately came up with this PR [#79859](https://github.com/kubernetes/kubernetes/pull/79859). &lt;br&gt; 
I was very happy at the point when this PR was merged. So, now again started to look over some of the open issues on github and no luck this time. But found some issue where this guy very new to Kubernetes was having hard time [Issue #79678](https://github.com/kubernetes/kubernetes/issues/79678)

So, was thinking of my next contribution and came up with the feature of flushing out the current namespace when there are no resources found [#79968](https://github.com/kubernetes/kubernetes/pull/79968) :smile:

I made these contributions in under a month and looking forward to contributing more to CNCF Projects.

I have also made a habit of reading the source code, If I have a doubt regarding anything related to kubernetes and I feel like this is the best way to learn.</content><author><name>Sukeesh</name></author><summary type="html">So, finally started contributing to the Kubernetes source code on github. At first, I was really worried after looking at the source code as It was too huge. But finally, I made up my mind to start with good first issues.</summary></entry><entry><title type="html">Installing helm chart</title><link href="http://localhost:4000/blog/2019-07-02/helm-init" rel="alternate" type="text/html" title="Installing helm chart" /><published>2019-07-02T00:00:00+05:30</published><updated>2019-07-02T00:00:00+05:30</updated><id>http://localhost:4000/blog/2019-07-02/helm-init</id><content type="html" xml:base="http://localhost:4000/blog/2019-07-02/helm-init">`$ helm init`

`$ helm create test-sukeesh`

This will create all the files necessary, We are only interested in `Chart.yaml`, `values.yaml` files.

`$ helm lint` this would lint all the files

Once you are done with all the changes, then go back to the root dir and do `helm install`

`$ cd ..`
`$ helm install test-sukeesh-0.1.0.tgz`

But, when you try above command, you might see some error related to invalid permissions.

So, when you try to tail the logs of tiller pod in `kube-system` namespace which is installed when we did `helm init`
We see these errors like these
```
tiller-deploy-c78f4c8d9-2q4jz tiller [tiller] 2019/07/02 07:56:00 preparing install for
tiller-deploy-c78f4c8d9-2q4jz tiller [storage] 2019/07/02 07:56:00 getting release &quot;orbiting-hog.v1&quot;
tiller-deploy-c78f4c8d9-2q4jz tiller [storage/driver] 2019/07/02 07:56:00 get: failed to get &quot;orbiting-hog.v1&quot;: configmaps &quot;orbiting-hog.v1&quot; is forbidden: User &quot;system:serviceaccount:kube-system:default&quot; cannot get resource &quot;configmaps&quot; in API group &quot;&quot; in the namespace &quot;kube-system&quot;
```
So, by default when we don't specify a service account in the service, this uses `&quot;system:serviceaccount:kube-system:default&quot;` service account but then this has no permissions.
So, create a Role-based access control file
`rbac-config.yaml`

```yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: tiller
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: tiller
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
  - kind: ServiceAccount
    name: tiller
    namespace: kube-system
```
Apply this `rbac-config.yaml` file

```
$ kubectl create -f rbac-config.yaml
serviceaccount &quot;tiller&quot; created
clusterrolebinding &quot;tiller&quot; created
```
You can see serviceaccount and clusterrolebinding &quot;tiller&quot; has been created successfully.
Verify with the following
```
$ kubectl get serviceaccounts | grep tiller
tiller                               1         30s
```
But, when you try installing the helm, you might again get the same error because we created a service account but did not associate it with our tiller deployment.

```
$ kubectl get deploy | grep tiller
tiller-deploy            1         1         1            1           91m
```

```
$ kubectl edit deploy tiller-deploy
deployment.extensions/tiller-deploy edited
```
Edit the `tiller-deploy` deployment and add serviceAccountName to spec.template.spec as below
```
...
serviceAccountName: tiller
...
```

Now, helm is able to install with no error

```
$ helm install test-sukeesh-0.1.0.tgz --debug

[debug] Created tunnel using local port: '52030'

[debug] SERVER: &quot;127.0.0.1:52030&quot;

[debug] Original chart version: &quot;&quot;
[debug] CHART PATH: /Users/sukeesh/Documents/helm/test-sukeesh-0.1.0.tgz

NAME:   alliterating-wildebeest
REVISION: 1
RELEASED: Tue Jul  2 21:27:15 2019
CHART: test-sukeesh-0.1.0
USER-SUPPLIED VALUES:
{}

COMPUTED VALUES:
affinity: {}
image:
  pullPolicy: IfNotPresent
  repository: daemonza/testapi
  tag: latest
ingress:
  annotations: {}
  enabled: false
  hosts:
  - chart-example.local
  path: /
  tls: []
nodeSelector: {}
replicaCount: 2
resources:
  limits:
    cpu: 100m
    memory: 128Mi
  requests:
    cpu: 100m
    memory: 128Mi
service:
  externalPort: 80
  internalPort: 80
  name: test-sukeesh
  port: 9000
  type: ClusterIP
tolerations: []

HOOKS:
MANIFEST:

---
# Source: test-sukeesh/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: alliterating-wildebeest-test-sukeesh
  labels:
    app: test-sukeesh
    chart: test-sukeesh-0.1.0
    release: alliterating-wildebeest
    heritage: Tiller
spec:
  type: ClusterIP
  ports:
    - port: 9000
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app: test-sukeesh
    release: alliterating-wildebeest
---
# Source: test-sukeesh/templates/deployment.yaml
apiVersion: apps/v1beta2
kind: Deployment
metadata:
  name: alliterating-wildebeest-test-sukeesh
  labels:
    app: test-sukeesh
    chart: test-sukeesh-0.1.0
    release: alliterating-wildebeest
    heritage: Tiller
spec:
  replicas: 2
  selector:
    matchLabels:
      app: test-sukeesh
      release: alliterating-wildebeest
  template:
    metadata:
      labels:
        app: test-sukeesh
        release: alliterating-wildebeest
    spec:
      containers:
        - name: test-sukeesh
          image: &quot;daemonza/testapi:latest&quot;
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /
              port: http
          readinessProbe:
            httpGet:
              path: /
              port: http
          resources:
            limits:
              cpu: 100m
              memory: 128Mi
            requests:
              cpu: 100m
              memory: 128Mi
LAST DEPLOYED: Tue Jul  2 21:27:15 2019
NAMESPACE: kube-system
STATUS: DEPLOYED

RESOURCES:
==&gt; v1/Service
NAME                                  TYPE       CLUSTER-IP     EXTERNAL-IP  PORT(S)   AGE
alliterating-wildebeest-test-sukeesh  ClusterIP  10.59.245.130  &lt;none&gt;       9000/TCP  1s

==&gt; v1beta2/Deployment
NAME                                  DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE
alliterating-wildebeest-test-sukeesh  2        2        2           0          0s

==&gt; v1/Pod(related)
NAME                                                   READY  STATUS             RESTARTS  AGE
alliterating-wildebeest-test-sukeesh-6d577d4888-bftnq  0/1    ContainerCreating  0         0s
alliterating-wildebeest-test-sukeesh-6d577d4888-ntmzz  0/1    ContainerCreating  0         0s


NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace kube-system -l &quot;app=test-sukeesh,release=alliterating-wildebeest&quot; -o jsonpath=&quot;{.items[0].metadata.name}&quot;)
  echo &quot;Visit http://127.0.0.1:8080 to use your application&quot;
  kubectl port-forward $POD_NAME 8080:80
```</content><author><name>Sukeesh</name></author><summary type="html">$ helm init</summary></entry><entry><title type="html">Dropbox Deduplication test</title><link href="http://localhost:4000/blog/2017-09-01/dropbox-deduplication" rel="alternate" type="text/html" title="Dropbox Deduplication test" /><published>2017-09-01T00:00:00+05:30</published><updated>2017-09-01T00:00:00+05:30</updated><id>http://localhost:4000/blog/2017-09-01/dropbox-deduplication</id><content type="html" xml:base="http://localhost:4000/blog/2017-09-01/dropbox-deduplication">It works by breaking files into blocks. Each of these blocks is hashed. Only blocks that are not yet known are uploaded to the server when syncing.

Check : [Dropbox blog](https://blogs.dropbox.com/dropbox/2011/07/changes-to-our-policies/)
### Test

I used this [video](https://www.youtube.com/watch?v=FBCmIFCpJBU) for testing which is `21.8 MB` in size.
The freshly downloaded file took 27 seconds ( approx ) to sync. Then, I renamed the file. This duplicate file took 4 seconds( approx )!

### Video

[![some random](https://img.youtube.com/vi/dDvfkiUxS-A/0.jpg)](https://www.youtube.com/watch?v=dDvfkiUxS-A)</content><author><name>Sukeesh</name></author><summary type="html">It works by breaking files into blocks. Each of these blocks is hashed. Only blocks that are not yet known are uploaded to the server when syncing.</summary></entry><entry><title type="html">Lowest Common Ancestor | Binary Lifting</title><link href="http://localhost:4000/blog/2016-08-22/lca-binary-lifting" rel="alternate" type="text/html" title="Lowest Common Ancestor | Binary Lifting" /><published>2016-08-22T00:00:00+05:30</published><updated>2016-08-22T00:00:00+05:30</updated><id>http://localhost:4000/blog/2016-08-22/lca-binary-lifting</id><content type="html" xml:base="http://localhost:4000/blog/2016-08-22/lca-binary-lifting">&lt;b&gt;What is LCA?&lt;/b&gt;

In graph theory and computer science, the lowest common ancestor (LCA) of two nodes v and w in a tree or directed acyclic graph (DAG) T is the lowest (i.e. deepest) node that has both v and w as descendants, where we define each node to be a descendant of itself (so if v has a direct connection from w, w is the lowest common ancestor).

LCA can be found in _logN_ time with _N * logN_ preprocessing.

---------

Variable | Description
------------- |---------
_L[i]_    | Level of node _i_ 
_P[i]_    | Parent of node _i_
_LCA[i][j]_ | 2&lt;sup&gt;j -th&lt;/sup&gt; ancestor of node _i_


----------

## Preprocessing

&lt;b&gt;Finding level and parent of each node using simple dfs&lt;/b&gt;

```cpp
void dfs(int node, int par){
    L[node] = L[par] + 1;
    par[node] = par;
    for ( int j = 0 ; j &lt; adj[node].size() ; j ++ ){
        int to = adj[node][j];
        if(to != par) dfs(to, node);
    }
}
```

&lt;b&gt;Filling in LCA array&lt;/b&gt;

&gt; Note: Any non negative number can be uniquely represented as a sum of decreasing powers of 2. This is just a variant of binary representation of a number. For number x, there can be at most log2(x) summands

We need to compute `LCA` table. For computing this value we may use following recursion

```cpp
LCA[i][j] = LCA[LCA[i][j-1]][j-1],  if j &gt; 0
----
LCA[i][j] = P[i],  if j = 0
```

if j &gt; 0,&lt;br&gt; _LCA[i][j]_ means 2&lt;sup&gt;j -th&lt;/sup&gt; ancestor of node _i_, which is nothing but 2&lt;sup&gt;(j-1) -th&lt;/sup&gt; ancestor of node _LCA[i][j-1]_

By using above recursion, we build LCA array as following
```cpp
void ConstructLCA(int n){
    lg = ceil(log2(n));
    int i, j;
    for ( i = 1 ; i &lt;= n ; i ++ ) LCA[i][0] = par[i];

    for ( i = 1 ; i &lt;= lg ; i ++ ) {
        for( j = 1 ; j &lt;= n ; j ++ ) {
            if( LCA[j][i-1] ) {
                LCA[j][i] = LCA[ LCA[j][i-1] ] [i-1];
            }
        }
    }
}
```

## Query

So, for every power j of 2, if `LCA[x][j] != LCA[y][j]` then we know that LCA(x, y) is on a higher level and we will continue searching for `LCA(x = LCA[x][j], y = LCA[y][j])`. At the end, both x and y will have the same father, so return P[x]. Let’s see what happens if `L[x] != L[y]`. Assume, without loss of generality, that L[p] &lt; L[q]. We can use the same meta-binary search for finding the ancestor of p situated on the same level with q, and then we can compute the LCA as described below.

```cpp
int getLca(int x, int y){
    
    if(L[x] &lt; L[y]){
        swap(x, y);
    }

    for(int i=lg; i &gt;= 0; i--){
        if( LCA[x][i] != 0 &amp;&amp; L[LCA[x][i]] &gt;= L[y] ){
            x = LCA[x][i];
        }
    }
    
    if( x == y ){
        return x;
    }

    for(int i = lg ; i &gt;= 0 ; i--){
        if( LCA[x][i] != 0 &amp;&amp; LCA[x][i] != LCA[y][i] ){
            x = LCA[x][i];
            y = LCA[y][i];
        }
    }

    return LCA[x][0];
}
```

We can observe that this function makes at most `2 * log(H)` operations (H is the height of the tree).



&lt;b&gt;My Implementation in C++&lt;/b&gt;&lt;br&gt;
[github/sukeesh/Algorithm-Implementations/graphs/LCA/LCAbinarylifting.cpp](https://github.com/sukeesh/Algorithm-Implementations/blame/master/graphs/LCA/LCAbinarylifting.cpp)

&lt;b&gt;Reference&lt;/b&gt;
[Topcoder tutorial](https://www.topcoder.com/community/competitive-programming/tutorials/range-minimum-query-and-lowest-common-ancestor/)</content><author><name>Sukeesh</name></author><summary type="html">What is LCA?</summary></entry><entry><title type="html">Sparse tables</title><link href="http://localhost:4000/blog/2016-01-14/sparse-table" rel="alternate" type="text/html" title="Sparse tables" /><published>2016-01-14T00:00:00+05:30</published><updated>2016-01-14T00:00:00+05:30</updated><id>http://localhost:4000/blog/2016-01-14/sparse-table</id><content type="html" xml:base="http://localhost:4000/blog/2016-01-14/sparse-table">What are sparse tables? 

- Data structure that allows range queries
- Can answer most queries in O(log N)
- But can answer Range Minimum Queries in O(1) 
    - An idempotent operation can be repeated an arbitrary number of times and the result will be the same as if it had been    done only once. In arithmetic, adding zero to a number is idempotent.
- It can be only used on immutable arrays. If you need any change, whole DS needs to be changed

Intuition

- Any non negative number can be uniquely represented as a sum of decreasing powers of 2. This is just a variant of binary representation of a number. For number x, there can be at most log2(x) summands
- So, by the same reasoning, any interval can be represented as a union of intervals with lengths that are decreasing powers of two. Eq.. [2, 14] = [2, 9] U [10, 13] U [14, 14]
- And hence, also here union consists of at most [log2(length of interval)] many intervals.
- MAIN IDEA: Pre-compute all answers for range queries with power of 2 length. So, afterwards combining all of them to receive a complete answer.


Precomputation

- We will maintain a 2D array
- Where table[i][j] will store the answer for the range [i, i + 2^j - 1] which can be split nicely into ranges 
    - [i, i + 2^{j-1} - 1] and [i + 2^(j-1), i + 2^j - 1] both of length 2^{j-1}
    - So, we can generate this table with dynamic programming

`K = log2(MAXN) + 1`

logarithmic values

```cpp
int log[MAXN+1];
log[1] = 0;
for (int i = 2; i &lt;= MAXN; i++)
    log[i] = log[i/2] + 1;
```

computing sparse table

```cpp
for (int i = 0; i &lt; MAXN; i++)
    table[i][0] = f(array[i]);

for (int j = 1; j &lt;= K; j++)
    for (int i = 0; i + (1 &lt;&lt; j) &lt;= MAXN; i++)
        table[i][j] = f(table[i][j-1], table[i + (1 &lt;&lt; (j - 1))][j - 1]);
```

Query

- for sum (between L and R)

```cpp
int sum = 0;
for (int j = K; j &gt;= 0; j--) {
    if ((1 &lt;&lt; j) &lt;= R - L + 1) {
        sum += table[L][j];
        L += 1 &lt;&lt; j;
    }
}
```

- for RMQ (Minimum between L and R)

```cpp
int j = log[R - L + 1];
int minimum = min(table[L][j], table[R - (1 &lt;&lt; j) + 1][j]);
```</content><author><name>Sukeesh</name></author><summary type="html">What are sparse tables?</summary></entry><entry><title type="html">Simple script to hack during contests</title><link href="http://localhost:4000/blog/2015-12-18/codeforces-hack" rel="alternate" type="text/html" title="Simple script to hack during contests" /><published>2015-12-18T00:00:00+05:30</published><updated>2015-12-18T00:00:00+05:30</updated><id>http://localhost:4000/blog/2015-12-18/codeforces-hack</id><content type="html" xml:base="http://localhost:4000/blog/2015-12-18/codeforces-hack">This is a simple shell script to hack during codeforces/topcoder rounds. `your_code.cpp` should be your code, `victim_code.cpp` should be victim's code. Write test case generator in `test.py` and run this bash file by `bash hack.sh`. This script keeps on iterating until it finds a test case where your_code.cpp and victim_code.cpp gives a different output. Once it finds a hack test case, this stops iterating. Now, you can copy the test case and hack.

### Happy Hacking!


```bash
while true
do
python test.py &gt; in
g++ your_code.cpp
./a.out &lt;in&gt; sukeesh
g++ victim_code.cpp
./a.out &lt;in&gt; victim
diff --brief &lt;(sort victim) &lt;(sort sukeesh) &gt;/dev/null
comp_value=$?
if [ $comp_value -eq 1 ]
then
	echo &quot; &quot;
	echo &quot;--------- HACK! --------&quot;
	echo &quot; Input : &quot;
	cat ./in
	echo &quot; Expected : &quot;
	cat ./sukeesh
	printf &quot;\n&quot;
	echo &quot; Recieved : &quot;
	cat ./victim
	printf &quot;\n&quot;
	break
else
	echo &quot; &quot;
	echo &quot;----------Same----------&quot;
	echo &quot; Input : &quot;
	cat ./in
	echo &quot; Expected : &quot;
	cat ./sukeesh
	printf &quot;\n&quot;
	echo &quot; Recieved : &quot;
	cat ./victim
	printf &quot;\n&quot;
fi
done

```

This is the script</content><author><name>Sukeesh</name><email>vsukeeshbabu@gmail.com</email></author><summary type="html">This is a simple shell script to hack during codeforces/topcoder rounds. your_code.cpp should be your code, victim_code.cpp should be victim’s code. Write test case generator in test.py and run this bash file by bash hack.sh. This script keeps on iterating until it finds a test case where your_code.cpp and victim_code.cpp gives a different output. Once it finds a hack test case, this stops iterating. Now, you can copy the test case and hack.</summary></entry><entry><title type="html">Save a file in vim without root permission</title><link href="http://localhost:4000/blog/2015-12-10/save-file-without-root" rel="alternate" type="text/html" title="Save a file in vim without root permission" /><published>2015-12-10T00:00:00+05:30</published><updated>2015-12-10T00:00:00+05:30</updated><id>http://localhost:4000/blog/2015-12-10/save-file-without-root</id><content type="html" xml:base="http://localhost:4000/blog/2015-12-10/save-file-without-root">This happens lot of times. You open Vim to edit a system file, do some changes, and `:wq`.
We won't be able to save a file due to permission issues. 

To save a file, simply type the following command.

`:w !sudo tee %` and enter the password as prompted. Voila.

## Add this to your ~/.vimrc file
Edit `~/.vimrc` and append the following code:
`command W :execute ':silent w !sudo tee % &gt; /dev/null' | :edit!`
Save and close the file. Now, try to edit a privileged file. Now, write a privileged file with custom command `:W`</content><author><name>Sukeesh</name></author><summary type="html">This happens lot of times. You open Vim to edit a system file, do some changes, and :wq. We won’t be able to save a file due to permission issues.</summary></entry><entry><title type="html">First Post</title><link href="http://localhost:4000/blog/2015-01-03/first-post" rel="alternate" type="text/html" title="First Post" /><published>2015-01-03T00:00:00+05:30</published><updated>2015-01-03T00:00:00+05:30</updated><id>http://localhost:4000/blog/2015-01-03/first-post</id><content type="html" xml:base="http://localhost:4000/blog/2015-01-03/first-post">Hey there! This is my first post!</content><author><name>Sukeesh</name></author><summary type="html">Hey there! This is my first post!</summary></entry><entry><title type="html">Example Content</title><link href="http://localhost:4000/blog/2011-03-16/example-content" rel="alternate" type="text/html" title="Example Content" /><published>2011-03-16T00:00:00+05:30</published><updated>2011-03-16T00:00:00+05:30</updated><id>http://localhost:4000/blog/2011-03-16/example-content</id><content type="html" xml:base="http://localhost:4000/blog/2011-03-16/example-content">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas tincidunt ornare nibh, non elementum augue tempus eget. Pellentesque tempus scelerisque iaculis. Nullam interdum ultricies nibh quis sollicitudin. Donec ornare fermentum facilisis. Ut at sem ac sem imperdiet varius a eget tortor. Nam eu augue eget orci semper maximus in eget augue. Mauris ornare, nisl ut suscipit consectetur, mi quam interdum tellus, at rutrum quam eros ultrices mi.

# Headers
{% highlight markdown %}
# H1
## H2
### H3
#### H4
##### H5
###### H6
{% endhighlight %}

# H1
## H2
### H3
#### H4
##### H5
###### H6

# Text formatting
{% highlight markdown %}
- **Bold**
- _Italics_
- ~~Strikethrough~~
- &lt;ins&gt;Underline&lt;/ins&gt;
- &lt;sup&gt;Superscript&lt;/sup&gt;
- &lt;sub&gt;Subscript&lt;/sub&gt;
- Abbreviation: &lt;abbr title=&quot;HyperText Markup Language&quot;&gt;HTML&lt;/abbr&gt;
- Citation: &lt;cite&gt;&amp;mdash; Chester How&lt;/cite&gt;
{% endhighlight %}

- **Bold**
- _Italics_
- ~~Strikethrough~~
- &lt;ins&gt;Underline&lt;/ins&gt;
- &lt;sup&gt;Superscript&lt;/sup&gt;
- &lt;sub&gt;Subscript&lt;/sub&gt;
- Abbreviation: &lt;abbr title=&quot;HyperText Markup Language&quot;&gt;HTML&lt;/abbr&gt;
- Citation: &lt;cite&gt;&amp;mdash; Chester How&lt;/cite&gt;

# Lists
{% highlight markdown %}
1. Ordered list item 1
2. Ordered list item 2
3. Ordered list item 3

* Unordered list item 1
* Unordered list item 2
* Unordered list item 3
{% endhighlight %}

1. Ordered list item 1
2. Ordered list item 2
3. Ordered list item 3

* Unordered list item 1
* Unordered list item 2
* Unordered list item 3

# Links
{% highlight markdown %}
Check out tale on [GitHub](https://github.com/chesterhow/tale).
{% endhighlight %}

Check out tale on [GitHub](https://github.com/chesterhow/tale).

# Images
{% highlight markdown %}
![Placeholder image](https://placehold.it/800x400 &quot;Placeholder image&quot;)

![Image with caption](https://placehold.it/700x400 &quot;Image with caption&quot;)
_This is an image with a caption_
{% endhighlight %}

![Placeholder image](https://placehold.it/800x400 &quot;Placeholder image&quot;)

![Image with caption](https://placehold.it/700x400 &quot;Image with caption&quot;)
_This is an image with a caption_

# Code and Syntax Highlighting
Use back-ticks for `inline code`. Multi-line code snippets are supported too through Pygments.

{% highlight js %}
// Sample javascript code
var s = &quot;JavaScript syntax highlighting&quot;;
alert(s);
{% endhighlight %}

{% highlight python %}
# Sample python code
s = &quot;Python syntax highlighting&quot;
print s
{% endhighlight %}

Adding `linenos` to the Pygments tag enables line numbers.

{% highlight js  linenos %}
// Sample javascript code
var s = &quot;JavaScript syntax highlighting&quot;;
alert(s);
{% endhighlight %}

# Blockquotes
{% highlight markdown %}
&gt; Curabitur blandit tempus porttitor. Nullam quis risus eget urna mollis ornare vel eu leo. Nullam id dolor id nibh ultricies vehicula ut id elit.

{% endhighlight %}

&gt; Curabitur blandit tempus porttitor. Nullam quis risus eget urna mollis ornare vel eu leo. Nullam id dolor id nibh ultricies vehicula ut id elit.

# Horizontal Rule &amp; Line Break
{% highlight markdown %}
Use `&lt;hr&gt;` for horizontal rules

&lt;hr&gt;

and `&lt;br&gt;` for line breaks.

&lt;br&gt;
{% endhighlight %}

Use `&lt;hr&gt;` for horizontal rules

&lt;hr&gt;

and `&lt;br&gt;` for line breaks.

&lt;br&gt;

_The end_</content><author><name>God</name></author><summary type="html">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas tincidunt ornare nibh, non elementum augue tempus eget. Pellentesque tempus scelerisque iaculis. Nullam interdum ultricies nibh quis sollicitudin. Donec ornare fermentum facilisis. Ut at sem ac sem imperdiet varius a eget tortor. Nam eu augue eget orci semper maximus in eget augue. Mauris ornare, nisl ut suscipit consectetur, mi quam interdum tellus, at rutrum quam eros ultrices mi.</summary></entry></feed>